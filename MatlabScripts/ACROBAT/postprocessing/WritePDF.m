function WritePDF(name, prpath,flags,deleteeps)%function WritePDF(name, prpath,flags)%Write a PDF file with the current figure.  If no path is specified,%the default path (set in the global DEFAULT_PRINT_FOLDER) is used.  %If that is not specified, the current directory is used.%Leave off the .pdf.%%If deleteeps = 1, the eps file will be deleted; otherwise (default), it will be kept%and so both .eps and .pdf files are written.%%Don't put spaces in the path -- it doesn't like it.%use SetDefaultPrintFolder(path) to set the default path.%%6/04 MHA.%To make this work one has to modify /Applications/MATLAB6p5/toolbox/matlab/graphics/private/ghostscript.m.  %The call to ghostscript returns fine, but matlab gets that silly "stacksize: can't set limit error.%I modified the function to NOT error when this happens, since the PDF is created jsut fine.%You can ignore the warning it gives.%     h=gcf;%     oldfigunits=get(h,'units');%     paperunits=get(h,'paperunits');%     set(h,'units',paperunits);%     figpos=get(h,'paperposition');%     ht=1.02*figpos(4);% the figure's height and width%     wd=1.02*figpos(3);%     psize=get(h,'papersize');%     left_os=(psize(1)-wd)/2;%     bot_os=(psize(2)-ht)/2;%     set(h,'paperposition',[left_os bot_os wd ht],'paperpositionmode','auto')%     set(h,'units',oldfigunits)%     opt='port';if nargin < 4    deleteeps=1;endglobal DEFAULT_PRINT_FOLDER;if ~exist('flags')	flags='';endif ~exist('prpath')	prpath=DEFAULT_PRINT_FOLDER;endif isempty(prpath)	prpath=cd;endif strcmp(prpath(end),filesep)==0    prpath=[prpath filesep];enddisp(['Printing figure as PDF to file '])disp([prpath name '.pdf'])disp(['using flags ' flags])%This next call does work, but an entire page is generated.  To avoid this%we write the EPS file and then call unix's ps2pdf13 to generate the pdf.%eval(['print -dpdf -dsetup ' flags ' ' prpath name '.pdf'])eval(['print -depsc  ' flags ' ' prpath name '.eps'])%Next convert%Now execute the unix command to convert the eps file to pdf.  We first%have to set the path properly to get it to find ps2pdf13.%Finally I find the script epstopdf which is now installed.  [status,result] = unix('echo $SHELL');if isempty(strfind(result,'tcsh'))% command=['PATH="$PATH:/usr/local/bin";export PATH;epstopdf ' prpath name '.eps'];command=['PATH="$PATH:/usr/local/bin";export PATH;epstopdf.pl ' prpath name '.eps'];else %tcshcommand=['set path=($PATH /usr/local/bin); epstopdf.pl ' prpath name '.eps'];end[status,result] = unix(command);%Now delete the eps file (default).if deleteeps==1    disp 'Deleting .eps file.'eval(['delete ' prpath name '.eps'])end%Now disp the string to paste into latexdisp(['\figtwo{6 in}{' name '}{ }'])disp(['Figure \ref{fig:' name '}'])